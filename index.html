<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificador de Carrera - Univalle</title>
    
    <!-- Favicon (Logo de Univalle como SVG para que siempre cargue) -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%23C62828' d='M50,5.3L94.7,27.6L94.7,72.4L50,94.7L5.3,72.4L5.3,27.6L50,5.3M50,0L0,25v50l50,25l50-25V25L50,0z'/%3E%3Cpath fill='%23FFFFFF' d='M50 15l35 20v30L50 85 15 65V35L50 15zm0 5.8L22.4 35v21.2l27.6 15.9 27.6-15.9V35L50 20.8z'/%3E%3C/svg%3E" type="image/svg+xml">
    
    <!-- Librerías Externas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- Fuentes de Google -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Hoja de estilos local -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white font-inter">

    <!-- CONTENEDOR DE AUTENTICACIÓN (Visible al inicio) -->
    <div id="auth-container" class="min-h-screen flex items-center justify-center p-4 relative overflow-hidden">
        <!-- Fondo animado -->
        <div class="absolute inset-0 overflow-hidden">
            <div class="floating-shape absolute top-10 left-10 w-20 h-20 bg-blue-500/20 rounded-full"></div>
            <div class="floating-shape absolute top-1/3 right-20 w-32 h-32 bg-purple-500/20 rounded-full" style="animation-delay: -2s;"></div>
            <div class="floating-shape absolute bottom-20 left-1/4 w-24 h-24 bg-pink-500/20 rounded-full" style="animation-delay: -4s;"></div>
        </div>

        <div class="w-full max-w-md relative z-10">
            <!-- Logo y bienvenida -->
            <div class="text-center mb-8">
                <a href="https://instagram.com/univallelegionestudiantil" target="_blank" class="inline-block mb-4">
                    <img id="legion-logo" src="data:image/png;base64,aquivaelcodigoqyapondreyomanualmentepqesmuylargooo=" 
                         alt="Legión Estudiantil" class="w-24 h-24 mx-auto rounded-full shadow-lg hover:scale-105 transition-transform duration-300">
                </a>
                <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-600 bg-clip-text text-transparent mb-2">
                    Planificador de Carrera
                </h1>
                <p class="text-slate-400 text-lg">Univalle - Diseño Industrial</p>
                <div class="mt-4 p-3 bg-slate-800/50 rounded-lg backdrop-blur-sm border border-slate-700">
                    <p class="text-sm text-slate-300 leading-relaxed">
                        ¡Bienvenido! Esperamos que disfrutes esta herramienta. 
                        <br>Desarrollado por la Representación de Diseño Industrial y 
                        <a href="https://instagram.com/univallelegionestudiantil" target="_blank" 
                           class="text-blue-400 hover:text-blue-300 underline">Legión Estudiantil</a>
                    </p>
                </div>
            </div>
            
            <div id="auth-forms-container" class="glassmorphism p-8 rounded-2xl shadow-2xl">
                <!-- Formulario de Inicio de Sesión (por defecto) -->
                <form id="login-form" class="">
                    <h2 class="text-2xl font-bold mb-6 text-center">Iniciar Sesión</h2>
                    <div class="space-y-4">
                        <div class="form-group">
                            <label for="login-email" class="block mb-2 text-sm font-medium text-slate-300">Correo Electrónico</label>
                            <input type="email" id="login-email" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label for="login-password" class="block mb-2 text-sm font-medium text-slate-300">Contraseña</label>
                            <input type="password" id="login-password" class="form-input" required>
                        </div>
                        <button type="submit" class="btn-primary w-full">Ingresar</button>
                    </div>
                </form>

                <!-- Formulario de Registro -->
                <form id="register-form" class="hidden">
                    <h2 class="text-2xl font-bold mb-6 text-center">Crear Cuenta</h2>
                    <div class="space-y-4">
                        <div class="form-group">
                            <label for="register-name" class="block mb-2 text-sm font-medium text-slate-300">Nombre</label>
                            <input type="text" id="register-name" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label for="register-email" class="block mb-2 text-sm font-medium text-slate-300">Correo Electrónico</label>
                            <input type="email" id="register-email" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label for="register-password" class="block mb-2 text-sm font-medium text-slate-300">Contraseña (mín. 6 caracteres)</label>
                            <input type="password" id="register-password" class="form-input" required>
                        </div>
                        <button type="submit" class="btn-primary w-full">Registrarse</button>
                    </div>
                </form>

                <p id="auth-error" class="text-red-400 text-sm mt-4 text-center font-medium"></p>
                <p class="text-center text-sm mt-6">
                    <a href="#" id="toggle-auth-mode" class="text-blue-400 hover:text-blue-300 underline transition-colors">
                        ¿No tienes cuenta? Regístrate
                    </a>
                </p>
            </div>

            <div class="mt-6 text-center">
                <p class="text-slate-400 text-sm mb-4">O continuar con</p>
                <button id="google-signin-btn" class="btn-google">
                    <svg class="w-5 h-5 mr-3" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Continuar con Google
                </button>
            </div>
        </div>
    </div>

    <!-- CONTENEDOR DE SELECCIÓN DE CARRERA (Oculto) -->
    <div id="career-selection-container" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md text-center glassmorphism p-8 rounded-2xl">
             <h1 id="welcome-message-career" class="text-3xl font-bold mb-8 bg-gradient-to-r from-blue-400 to-purple-600 bg-clip-text text-transparent"></h1>
             <p class="text-xl mb-6 text-slate-300">¿Qué carrera quieres planificar hoy?</p>
             <div id="career-list" class="space-y-4">
                <button data-career-id="diseno-industrial" class="career-select-btn">
                    <span class="text-xl">🎨</span>
                    <span>Diseño Industrial</span>
                </button>
             </div>
             <button id="logout-btn-career" class="mt-8 text-sm text-slate-400 hover:text-white transition-colors">
                Cerrar Sesión
             </button>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL DE LA APP (Oculto) -->
    <div id="app-container" class="hidden min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
        <!-- Encabezado -->
        <header class="sticky top-0 z-20 glassmorphism border-b border-slate-700/50">
            <div class="flex justify-between items-center p-4">
                <div class="flex items-center gap-4">
                    <a href="https://instagram.com/univallelegionestudiantil" target="_blank" class="flex-shrink-0">
                        <img id="header-logo" src="data:image/png;base64,aquivaelcodigoqyapondreyomanualmentepqesmuylargooo=" 
                             alt="Legión Estudiantil" class="w-12 h-12 rounded-full hover:scale-105 transition-transform">
                    </a>
                    <div class="flex items-center gap-4">
                        <div id="profile-pic-container" class="relative cursor-pointer group">
                            <img id="profile-pic" src="https://placehold.co/100x100/2a2a2a/e5e5e5?text=User" 
                                 alt="Foto de perfil" class="w-12 h-12 rounded-full border-2 border-slate-600 group-hover:border-blue-400 transition-colors">
                            <input type="file" id="profile-pic-upload" class="hidden" accept="image/*">
                        </div>
                        <div>
                            <h1 id="welcome-message-main" class="text-lg font-bold"></h1>
                            <p class="text-sm text-slate-400">Diseño Industrial - Univalle</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button id="logout-btn-main" class="btn-secondary text-sm">Cerrar Sesión</button>
                    <div class="theme-toggle-container">
                        <label for="theme-toggle" class="theme-switch">
                            <input type="checkbox" id="theme-toggle">
                            <span class="slider">
                                <span class="slider-icon sun">☀️</span>
                                <span class="slider-icon moon">🌙</span>
                            </span>
                        </label>
                    </div>
                </div>
            </div>
        </header>

        <!-- Contenido Principal -->
        <main class="flex flex-col lg:flex-row min-h-0 flex-1">
            <!-- Panel Izquierdo (Banco de Materias y Acciones) -->
            <aside id="left-panel" class="w-full lg:w-1/3 xl:w-1/4 p-4 space-y-6 overflow-y-auto">
                <div class="stats-board grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4"></div>
                
                <div class="action-buttons grid grid-cols-2 gap-3">
                    <button id="add-semester-btn" class="btn-primary text-sm">📅 Semestre</button>
                    <button id="open-equivalencies-modal-btn" class="btn-primary text-sm">⚖️ Equivalencias</button>
                    <button id="open-fg-elective-modal-btn" class="btn-secondary text-sm">📚 Electiva FG</button>
                    <button id="open-prof-elective-modal-btn" class="btn-secondary text-sm">🎓 Electiva EP</button>
                    <button id="open-pdf-modal-btn" class="btn-secondary text-sm">📄 Exportar PDF</button>
                    <button id="reset-button" class="btn-danger text-sm">🔄 Reiniciar</button>
                </div>

                <div id="subject-bank" class="glassmorphism rounded-xl p-4">
                    <h2 class="text-xl font-bold mb-4 text-center">Banco de Materias</h2>
                    <div id="bank-content"></div>
                </div>
            </aside>

            <!-- Panel Derecho (Semestres) -->
            <section id="right-panel" class="flex-1 p-4 overflow-x-auto">
                <div id="semesters-grid" class="semesters-grid-container">
                    <!-- Los semestres se generan aquí -->
                </div>
            </section>
        </main>
    </div>

    <!-- MODALES -->
    <div id="pdf-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="close-pdf-modal-btn" class="modal-close-btn">&times;</button>
            <h2 class="text-2xl font-bold mb-6 text-center">📄 Generar Reporte PDF</h2>
            <form id="pdf-info-form" class="space-y-4">
                <div class="form-group">
                    <label for="student-name" class="block mb-2 font-medium">Nombre Completo</label>
                    <input type="text" id="student-name" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="student-id" class="block mb-2 font-medium">Código de Estudiante</label>
                    <input type="text" id="student-id" class="form-input" required>
                </div>
                <button type="submit" class="btn-primary w-full">Generar PDF</button>
            </form>
        </div>
    </div>

    <div id="elective-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="close-elective-modal-btn" class="modal-close-btn">&times;</button>
            <h2 id="elective-modal-title" class="text-2xl font-bold mb-6 text-center"></h2>
            <div class="flex border-b border-slate-600 mb-4">
                <button id="tab-catalog" class="modal-tab active">📋 Catálogo</button>
                <button id="tab-custom" class="modal-tab">✏️ Personalizada</button>
            </div>
            <div id="content-catalog" class="modal-tab-content active">
                <input type="text" id="elective-search" placeholder="🔍 Buscar por nombre o código..." class="form-input mb-4">
                <div id="elective-catalog-list" class="space-y-2 max-h-96 overflow-y-auto pr-2"></div>
            </div>
            <div id="content-custom" class="modal-tab-content space-y-4">
                <form id="add-custom-elective-form" class="space-y-4">
                    <div class="form-group">
                        <label for="custom-elective-name" class="block mb-2 font-medium">Nombre</label>
                        <input type="text" id="custom-elective-name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="custom-elective-credits" class="block mb-2 font-medium">Créditos</label>
                        <input type="number" id="custom-elective-credits" class="form-input" min="1" max="10" required>
                    </div>
                    <button type="submit" class="btn-primary w-full">Añadir Personalizada</button>
                </form>
            </div>
        </div>
    </div>
    
    <div id="equivalencies-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="close-equivalencies-modal-btn" class="modal-close-btn">&times;</button>
            <h2 class="text-2xl font-bold mb-6 text-center">⚖️ Materias por Equivalencia</h2>
            <p class="text-sm text-slate-400 mb-4 text-center">
                Añade materias que hayas homologado de otras carreras o universidades.
            </p>
            <form id="add-equivalence-form" class="flex gap-2 mb-6">
                <input type="text" id="equivalence-name" placeholder="Nombre de la materia" class="form-input flex-grow">
                <input type="number" id="equivalence-credits" placeholder="Créditos" class="form-input w-24" min="1" max="10" required>
                <button type="submit" class="btn-primary px-4 rounded-lg">Añadir</button>
            </form>
            <div id="equivalencies-list" class="space-y-2 max-h-60 overflow-y-auto">
                <!-- Las equivalencias se listarán aquí -->
            </div>
        </div>
    </div>

    <div id="loading-overlay" class="modal-overlay hidden">
        <div class="text-center">
            <div class="loader mb-4"></div>
            <p id="loading-text" class="text-lg font-medium">Cargando...</p>
        </div>
    </div>

    <!-- SDKs de Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- Tu script principal -->
    <script src="script.js"></script>
</body>
</html>
