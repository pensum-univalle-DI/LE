<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificador de Carrera - Univalle</title>
    
    <!-- Favicon (Logo de Univalle como SVG para que siempre cargue) -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%23C62828' d='M50,5.3L94.7,27.6L94.7,72.4L50,94.7L5.3,72.4L5.3,27.6L50,5.3M50,0L0,25v50l50,25l50-25V25L50,0z'/%3E%3Cpath fill='%23FFFFFF' d='M50 15l35 20v30L50 85 15 65V35L50 15zm0 5.8L22.4 35v21.2l27.6 15.9 27.6-15.9V35L50 20.8z'/%3E%3C/svg%3E" type="image/svg+xml">
    
    <!-- Librerías Externas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- Fuentes de Google -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Hoja de estilos local -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-primary text-primary font-sans">

    <!-- CONTENEDOR DE AUTENTICACIÓN (Visible al inicio) -->
    <div id="auth-container" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md">
            <h1 class="text-3xl font-bold text-center mb-2">Planificador de Carrera</h1>
            <p class="text-center text-secondary mb-8">Inicia sesión para continuar</p>
            
            <div id="auth-forms-container" class="bg-secondary p-8 rounded-xl shadow-lg">
                <!-- Formulario de Inicio de Sesión (por defecto) -->
                <form id="login-form" class="">
                    <h2 class="text-xl font-bold mb-4">Iniciar Sesión</h2>
                    <div class="mb-4">
                        <label for="login-email" class="block mb-2 text-sm font-medium">Correo Electrónico</label>
                        <input type="email" id="login-email" class="w-full p-3 bg-tertiary border border-color rounded-md" required>
                    </div>
                    <div class="mb-4">
                        <label for="login-password" class="block mb-2 text-sm font-medium">Contraseña</label>
                        <input type="password" id="login-password" class="w-full p-3 bg-tertiary border border-color rounded-md" required>
                    </div>
                    <button type="submit" class="btn-primary w-full py-3 rounded-md font-semibold">Ingresar</button>
                </form>

                <!-- Formulario de Registro -->
                <form id="register-form" class="hidden">
                    <h2 class="text-xl font-bold mb-4">Crear Cuenta</h2>
                     <div class="mb-4">
                        <label for="register-name" class="block mb-2 text-sm font-medium">Nombre</label>
                        <input type="text" id="register-name" class="w-full p-3 bg-tertiary border border-color rounded-md" required>
                    </div>
                    <div class="mb-4">
                        <label for="register-email" class="block mb-2 text-sm font-medium">Correo Electrónico</label>
                        <input type="email" id="register-email" class="w-full p-3 bg-tertiary border border-color rounded-md" required>
                    </div>
                    <div class="mb-4">
                        <label for="register-password" class="block mb-2 text-sm font-medium">Contraseña (mín. 6 caracteres)</label>
                        <input type="password" id="register-password" class="w-full p-3 bg-tertiary border border-color rounded-md" required>
                    </div>
                    <button type="submit" class="btn-primary w-full py-3 rounded-md font-semibold">Registrarse</button>
                </form>

                <p id="auth-error" class="text-red-500 text-sm mt-4 text-center"></p>
                <p class="text-center text-sm mt-4">
                    <a href="#" id="toggle-auth-mode" class="text-accent hover:underline">¿No tienes cuenta? Regístrate</a>
                </p>
            </div>

            <div class="mt-6 text-center">
                <p class="text-secondary text-sm mb-2">O inicia sesión con</p>
                <button id="google-signin-btn" class="bg-white text-gray-800 font-semibold py-2 px-4 border border-gray-300 rounded-lg shadow-sm hover:bg-gray-100 flex items-center justify-center w-full max-w-xs mx-auto">
                    <img src="https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png" alt="Google logo" class="h-6 mr-3">
                    Continuar con Google
                </button>
            </div>
        </div>
    </div>

    <!-- CONTENEDOR DE SELECCIÓN DE CARRERA (Oculto) -->
    <div id="career-selection-container" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md text-center">
             <h1 id="welcome-message-career" class="text-3xl font-bold mb-8"></h1>
             <p class="text-xl mb-4">¿Qué carrera quieres planificar hoy?</p>
             <div id="career-list" class="space-y-4">
                <button data-career-id="diseno-industrial" class="career-select-btn bg-secondary hover:bg-tertiary w-full p-4 rounded-lg text-lg font-semibold">
                    Diseño Industrial
                </button>
                <!-- Más carreras se pueden añadir aquí -->
             </div>
             <button id="logout-btn-career" class="mt-8 text-sm text-secondary hover:text-primary">Cerrar Sesión</button>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL DE LA APP (Oculto) -->
    <div id="app-container" class="hidden">
        <!-- Encabezado -->
        <header class="p-4 flex flex-wrap justify-between items-center gap-4 bg-secondary shadow-md sticky top-0 z-20">
            <div class="flex items-center gap-4">
                <div id="profile-pic-container">
                    <img id="profile-pic" src="https://placehold.co/100x100/2a2a2a/e5e5e5?text=User" alt="Foto de perfil">
                    <input type="file" id="profile-pic-upload" class="hidden" accept="image/*">
                </div>
                <div>
                    <h1 id="welcome-message-main" class="text-lg font-bold"></h1>
                    <p class="text-sm text-secondary">Diseño Industrial - Univalle</p>
                </div>
            </div>
            <div class="flex items-center gap-2 sm:gap-4">
                <button id="logout-btn-main" class="btn-secondary text-xs sm:text-sm">Cerrar Sesión</button>
                <label for="theme-toggle" class="theme-switch">
                    <input type="checkbox" id="theme-toggle">
                    <span class="slider"></span>
                </label>
            </div>
        </header>

        <!-- Contenido Principal -->
        <main class="flex flex-col lg:flex-row h-full">
            <!-- Panel Izquierdo (Banco de Materias y Acciones) -->
            <aside id="left-panel" class="w-full lg:w-1/3 xl:w-1/4 p-4 space-y-4 overflow-y-auto">
                <div class="stats-board grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-2 gap-2"></div>
                
                <div class="action-buttons grid grid-cols-2 gap-2">
                    <button id="add-semester-btn" class="btn-primary">Añadir Semestre</button>
                    <button id="open-equivalencies-modal-btn" class="btn-primary">Equivalencias</button>
                    <button id="open-fg-elective-modal-btn" class="btn-secondary">Electiva FG</button>
                    <button id="open-prof-elective-modal-btn" class="btn-secondary">Electiva EP</button>
                    <button id="open-pdf-modal-btn" class="btn-secondary">Exportar PDF</button>
                    <button id="reset-button" class="btn-danger">Reiniciar Plan</button>
                </div>

                <div id="subject-bank" class="bg-secondary p-4 rounded-lg">
                    <h2 class="text-xl font-bold mb-4">Banco de Materias</h2>
                    <div id="bank-content"></div>
                </div>
            </aside>

            <!-- Panel Derecho (Semestres) -->
            <section id="right-panel" class="w-full lg:w-2/3 xl:w-3/4 p-4 overflow-x-auto">
                <div id="semesters-grid" class="semesters-grid-container">
                    <!-- Los semestres se generan aquí -->
                </div>
            </section>
        </main>
    </div>

    <!-- MODALES -->
    <div id="pdf-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="close-pdf-modal-btn" class="modal-close-btn">&times;</button>
            <h2 class="text-xl font-bold mb-4">Generar Reporte PDF</h2>
            <form id="pdf-info-form">
                <div class="mb-4"><label for="student-name" class="block mb-2">Nombre Completo</label><input type="text" id="student-name" class="w-full p-2 bg-tertiary border border-color rounded-md" required></div>
                <div class="mb-4"><label for="student-id" class="block mb-2">Código de Estudiante</label><input type="text" id="student-id" class="w-full p-2 bg-tertiary border border-color rounded-md" required></div>
                <button type="submit" class="btn-primary w-full py-2 rounded-md font-semibold">Generar PDF</button>
            </form>
        </div>
    </div>

    <div id="elective-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="close-elective-modal-btn" class="modal-close-btn">&times;</button>
            <h2 id="elective-modal-title" class="text-xl font-bold mb-4"></h2>
            <div class="flex border-b border-color mb-4">
                <button id="tab-catalog" class="modal-tab active">Catálogo</button>
                <button id="tab-custom" class="modal-tab">Personalizada</button>
            </div>
            <div id="content-catalog" class="modal-tab-content active">
                <input type="text" id="elective-search" placeholder="Buscar por nombre o código..." class="w-full p-2 mb-4 bg-tertiary border border-color rounded-md">
                <div id="elective-catalog-list" class="space-y-2 pr-2"></div>
            </div>
            <div id="content-custom" class="modal-tab-content">
                <form id="add-custom-elective-form">
                    <div class="mb-4"><label for="custom-elective-name" class="block mb-2">Nombre</label><input type="text" id="custom-elective-name" class="w-full p-2 bg-tertiary border border-color rounded-md" required></div>
                    <div class="mb-4"><label for="custom-elective-credits" class="block mb-2">Créditos</label><input type="number" id="custom-elective-credits" class="w-full p-2 bg-tertiary border border-color rounded-md" min="1" max="10" required></div>
                    <button type="submit" class="btn-primary w-full py-2 rounded-md font-semibold">Añadir Personalizada</button>
                </form>
            </div>
        </div>
    </div>
    
    <div id="equivalencies-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="close-equivalencies-modal-btn" class="modal-close-btn">&times;</button>
            <h2 class="text-xl font-bold mb-4">Materias por Equivalencia</h2>
            <p class="text-sm text-secondary mb-4">Añade materias que hayas homologado de otras carreras o universidades. Estas contarán para tu progreso total.</p>
            <form id="add-equivalence-form" class="flex gap-2 mb-4">
                <input type="text" id="equivalence-name" placeholder="Nombre de la materia" class="flex-grow p-2 bg-tertiary border border-color rounded-md" required>
                <input type="number" id="equivalence-credits" placeholder="Créditos" class="w-24 p-2 bg-tertiary border border-color rounded-md" min="1" max="10" required>
                <button type="submit" class="btn-primary px-4 rounded-md font-semibold">Añadir</button>
            </form>
            <div id="equivalencies-list" class="space-y-2 max-h-60 overflow-y-auto">
                <!-- Las equivalencias se listarán aquí -->
            </div>
        </div>
    </div>

    <div id="loading-overlay" class="modal-overlay hidden">
        <div class="loader"></div>
        <p id="loading-text" class="mt-4 text-lg">Cargando...</p>
    </div>

    <!-- SDKs de Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- Tu script principal -->
    <script src="script.js"></script>
</body>
</html>
